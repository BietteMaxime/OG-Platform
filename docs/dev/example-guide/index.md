[TOC]

## Creating and Running Examples

This is a guide to writing Java examples for OpenGamma and making use of the output in documentation.

{% set example_class = 'com.opengamma.analytics.example.timeseries.TimeSeriesExample' -%}

Examples classes should be included in the main code base. Here is one such example class, in package `{{ d['/shared/docs.sqlite3']["%s::package" % example_class] }}`:

{{ highlight(d['/shared/docs.sqlite3']["%s::source" % example_class], 'java') }}

{% set example_function = 'timeSeriesExample' -%}

The example method `{{ example_function }}` is a static method takes a single argument, a PrintStream. This PrintStream object should be used to write any output that you wish to preserve later.

The output from running this example is:

<pre>
{{ d['/shared/example-output.json'][example_class][example_function] }}
</pre>

In the {{ example_class }} class, a `main` method has also been defined which calls the {{ example_function }} example and passes `System.out` as the PrintStream. This is one way to run these examples and observe the output. Within Dexy, these examples are run via a special helper script which identifies the examples to run, runs them, and saves the output in a data structure for later retrieval.

{{ d['/shared/RunExamples.java|idio']['run-method'] }}

The example code is run, then the PrintStream object passed to it is flushed and the contents saved in a JSON-based key-value store under the method's name. The list of methods to be run is determined by iterating over the following list of class names:

{{ d['/shared/RunExamples.java|idio']['class-names'] }}

And finding any methods defined in these classes which accept a single argument of class PrintStream:

{{ d['/shared/RunExamples.java|idio']['find-methods-to-run'] }}

You can create additional examples, and by following these conventions they will be run. For now class names must be manually added to the list in the classNames() method.

You can have multiple examples within a single example class, which is useful for sharing helper functions among multiple examples and building up more complex examples which make use of simpler building blocks.

If you make changes to OpenGamma source code files, you need to recompile the OG jars in order for Dexy to run the updated examples. And you need to run the `ant docs` task again for the database to be updated with the latest source code.

## Documenting and Showing Examples

The source code for all OpenGamma java files, including examples, is stored in a sqlite database under a simple key-value storage system, generated by the `ant docs` task. This file is named `docs.sqlite3` and is located in the docs/shared directory. You can view an automatically generated text file listing all available keys [here](index.txt), it is generated by this template:

<pre>
{{ d['index.txt|pyg'] }}
</pre>

You can also use the `dexy grep` command to help search for the names of keys.

<pre>
ubuntu@domU-12-31-39-18-36-08:/mnt/work/OG-Platform/projects/OG-Analytics/docs$ dexy grep -expr sqlite3 -keyexpr "yieldCurveBundle("
shared/docs.sqlite3
  key-value store keys:
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle():comment-text
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle():flat-signature
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle():modifiers
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle():name
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle():qualified-name
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle():raw-comment-text
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle():signature
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle():source
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle(Map):comment-text
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle(Map):flat-signature
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle(Map):modifiers
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle(Map):name
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle(Map):qualified-name
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle(Map):raw-comment-text
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle(Map):signature
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle(String[],YieldAndDiscountCurve[]):comment-text
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle(String[],YieldAndDiscountCurve[]):flat-signature
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle(String[],YieldAndDiscountCurve[]):modifiers
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle(String[],YieldAndDiscountCurve[]):name
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle(String[],YieldAndDiscountCurve[]):qualified-name
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle(String[],YieldAndDiscountCurve[]):raw-comment-text
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle(String[],YieldAndDiscountCurve[]):signature
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle(String[],YieldAndDiscountCurve[]):source
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle(YieldCurveBundle):comment-text
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle(YieldCurveBundle):flat-signature
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle(YieldCurveBundle):modifiers
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle(YieldCurveBundle):name
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle(YieldCurveBundle):qualified-name
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle(YieldCurveBundle):raw-comment-text
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle(YieldCurveBundle):signature
    com.opengamma.analytics.financial.interestrate:YieldCurveBundle(YieldCurveBundle):source
</pre>

Type `dexy help -on grep` for more details.

Source code is available at a class and method level, along with various types of metadata and field values.

Here is an example of pulling in method source code:

<pre>
{{ d['show-examples.html|xxml']['example-1:text'] }}
</pre>

Here is what gets pulled in from running jinja on this:

<pre>
{{ d['show-examples.html|jinjajit|xxml']['example-1:text'] }}
</pre>

Note that method arguments need to be included in order to distinguish between overloaded methods.

To create documentation, we want to make use of source code and docstrings from the OpenGamma code base, and also the output from running examples.

Here is some code which automatically picks out examples and shows their source code, and also the output generated by running these examples:

{{ d['examples.md|pyg'] }}

Here you can [browse the generated file](examples.html).

TODO discuss fields

if you want to include constant values in your docs, make sure the constants are marked public

